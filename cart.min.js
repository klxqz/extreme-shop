$(function(){function a(b){$(".cart-total").html(b.total);if(b.discount_numeric){$(".cart-discount").closest("tr").show()}$(".cart-discount").html("&minus; "+b.discount);if(b.add_affiliate_bonus){$(".affiliate").show().html(b.add_affiliate_bonus)}else{$(".affiliate").hide()}}$(".services input:checkbox").click(function(){var b=$('select[name="service_variant['+$(this).closest("tr").data("id")+"]["+$(this).val()+']"]');if(b.length){if($(this).is(":checked")){b.removeAttr("disabled")}else{b.attr("disabled","disabled")}}});$(".cart a.delete").click(function(){var b=$(this).closest("tr");$.post("delete/",{html:1,id:b.data("id")},function(c){if(c.data.count==0){location.reload()}b.remove();a(c.data)},"json");return false});$(".cart input.qty").change(function(){var b=$(this);if(b.val()>0){var c=b.closest("tr");if(b.val()){$.post("save/",{html:1,id:c.data("id"),quantity:b.val()},function(d){c.find(".item-total").html(d.data.item_total);if(d.data.q){b.val(d.data.q)}if(d.data.error){alert(d.data.error)}else{b.removeClass("error")}a(d.data)},"json")}}else{b.val(1)}});$(".cart .services input:checkbox").change(function(){var f=$(this).closest("div");var e=$(this).closest("tr");if($(this).is(":checked")){var d=$(this).closest("tr").data("id");var c={html:1,parent_id:d,service_id:$(this).val()};var b=$('select[name="service_variant['+d+"]["+$(this).val()+']"]');if(b.length){c.service_variant_id=b.val()}$.post("add/",c,function(g){f.data("id",g.data.id);e.find(".item-total").html(g.data.item_total);a(g.data)},"json")}else{$.post("delete/",{html:1,id:f.data("id")},function(g){f.data("id",null);e.find(".item-total").html(g.data.item_total);a(g.data)},"json")}});$(".cart .services select").change(function(){var b=$(this).closest("tr");$.post("save/",{html:1,id:$(this).closest("div").data("id"),service_variant_id:$(this).val()},function(c){b.find(".item-total").html(c.data.item_total);a(c.data)},"json")});$("#cancel-affiliate").click(function(){$(this).closest("form").append('<input type="hidden" name="use_affiliate" value="0">').submit();return false});$(".cart_quantity_up").click(function(){var b=$(this).closest(".cart_quantity").find(".cart_quantity_input");var c=parseInt(b.val());b.val(c+1);b.change()});$(".cart_quantity_down").click(function(){var b=$(this).closest(".cart_quantity").find(".cart_quantity_input");var c=parseInt(b.val());if(c-1>0){b.val(c-1);b.change()}})});