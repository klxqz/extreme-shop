function Product(d,c){this.form=$(d);this.add2cart=this.form.find(".add2cart");this.button=this.form.find("#add_to_cart button");for(var b in c){this[b]=c[b]}var a=this;this.form.find(".services input[type=checkbox]").click(function(){var e=$('select[name="service_variant['+$(this).val()+']"]');if(e.length){if($(this).is(":checked")){e.removeAttr("disabled")}else{e.attr("disabled","disabled")}}a.updatePrice()});this.form.find(".services .service-variants").on("change",function(){a.updatePrice()});this.form.find(".skus input[type=radio]").click(function(){if($(this).data("image-id")){$("#product-image-"+$(this).data("image-id")).click()}if($(this).data("disabled")){a.button.attr("disabled","disabled")}else{a.button.removeAttr("disabled")}var e=$(this).val();a.updateSkuServices(e);a.updatePrice()});this.form.find(".skus input[type=radio]:checked").click();this.form.find("select.sku-feature").change(function(){var e="";a.form.find("select.sku-feature").each(function(){e+=$(this).data("feature-id")+":"+$(this).val()+";"});var f=a.features[e];if(f){if(f.image_id){$("#product-image-"+f.image_id).click()}a.updateSkuServices(f.id);if(f.available){a.button.removeAttr("disabled")}else{a.form.find("div.stocks div").hide();a.form.find(".sku-no-stock").show();a.button.attr("disabled","disabled")}a.add2cart.find(".price").data("price",f.price);a.updatePrice(f.price,f.compare_price)}else{a.form.find("div.stocks div").hide();a.form.find(".sku-no-stock").show();a.button.attr("disabled","disabled");a.add2cart(".compare-at-price").hide();a.add2cart(".price").empty()}});this.form.find("select.sku-feature:first").change();if(!this.form.find(".skus input:radio:checked").length){this.form.find(".skus input:radio:enabled:first").attr("checked","checked")}this.form.submit(function(){var e=$(this);$.post(e.attr("action")+"?html=1",e.serialize(),function(f){if(f.status=="ok"){if($("#product").hasClass("content_only")){var g=window.parent.$(".shopping_cart")}else{var g=$(".shopping_cart")}var h=e;var i=$('<div class="cart"></div>').append(e.clone());if(h.closest(".dialog").length){i.insertAfter(h.closest(".dialog"))}else{i.insertAfter(h)}i.css({top:h.offset().top-$(window).scrollTop(),left:h.offset().left,width:h.width()+"px",height:h.height()+"px",position:"fixed",overflow:"hidden","z-index":9999}).animate({top:g.offset().top,left:g.offset().left,width:0,height:0},500,function(){$(this).remove();var n=parseInt($("#quantity_wanted").val());if(g.find("dt[data-id="+f.data.item_id+"]").length){var k=g.find("dt[data-id="+f.data.item_id+"]");var m=parseInt(k.find(".quantity").text());k.find(".quantity").text(m+n);g.find(".ajax_block_cart_total").html(f.data.total);g.find(".ajax_cart_quantity").text(f.data.count)}else{var l=h.find(".ajax_product_info");var j={url:l.data("url"),name:l.data("name"),img:l.data("img"),price:l.data("price"),quantity:n,id:f.data.item_id};$("#cart_block_list_item_tmpl").tmpl(j).appendTo(g.find(".cart_block_list .products"));g.find(".ajax_block_cart_total").html(f.data.total);g.find(".ajax_cart_quantity").html(f.data.count);g.find(".ajax_cart_discount").html(f.data.discount);g.find(".ajax_cart_no_product").addClass("unvisible");g.find(".ajax_cart_product_txt_s").removeClass("unvisible");g.find(".ajax_cart_quantity").removeClass("unvisible")}});if(h.closest(".dialog").length){h.closest(".dialog").hide().find(".cart").empty()}if(f.data.error){alert(f.data.error)}}else{if(f.status=="fail"){alert(f.errors)}}},"json");return false})}Product.prototype.currencyFormat=function(d,k){var f,e,h,g,a;var b=this.currency.frac_digits;var l=this.currency.decimal_point;var c=this.currency.thousands_sep;if(isNaN(b=Math.abs(b))){b=2}if(l==undefined){l=","}if(c==undefined){c="."}f=parseInt(d=(+d||0).toFixed(b))+"";if((e=f.length)>3){e=e%3}else{e=0}a=(e?f.substr(0,e)+c:"");h=f.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+c);g=(b&&(d-f)?l+Math.abs(d-f).toFixed(b).replace(/-/,0).slice(2):"");var d=a+h+g;var m=k?this.currency.sign:this.currency.sign_html;if(!this.currency.sign_position){return m+this.currency.sign_delim+d}else{return d+this.currency.sign_delim+m}};Product.prototype.serviceVariantHtml=function(c,a,b){return $('<option data-price="'+b+'" value="'+c+'"></option>').text(a+" (+"+this.currencyFormat(b,1)+")")};Product.prototype.updateSkuServices=function(d){this.form.find("div.stocks div").hide();this.form.find(".sku-"+d+"-stock").show();for(var c in this.services[d]){var b=this.services[d][c];if(b===false){this.form.find(".service-"+c).hide().find("input,select").attr("disabled","disabled").removeAttr("checked")}else{this.form.find(".service-"+c).show().find("input").removeAttr("disabled");if(typeof(b)=="string"){this.form.find(".service-"+c+" .service-price").html(this.currencyFormat(b));this.form.find(".service-"+c+" input").data("price",b)}else{var a=this.form.find(".service-"+c+" .service-variants");var g=a.val();for(var f in b){var e=a.find("option[value="+f+"]");if(b[f]===false){e.hide();if(e.attr("value")==g){g=false}}else{if(!g){g=f}e.replaceWith(this.serviceVariantHtml(f,b[f][0],b[f][1]))}}this.form.find(".service-"+c+" .service-variants").val(g)}}}};Product.prototype.updatePrice=function(d,c){if(d===undefined){var a=this.form.find(".skus input:radio:checked");if(a.length){var d=parseFloat(a.data("price"));var c=parseFloat(a.data("compare-price"))}else{var d=parseFloat(this.add2cart.find(".price").data("price"))}}if(c){if(!this.add2cart.find(".compare-at-price").length){this.add2cart.prepend('<span class="compare-at-price nowrap"></span>')}this.add2cart.find(".compare-at-price").html(this.currencyFormat(c)).show()}else{this.add2cart.find(".compare-at-price").hide()}var b=this;this.form.find(".services input:checked").each(function(){var e=$(this).val();if(b.form.find(".service-"+e+"  .service-variants").length){d+=parseFloat(b.form.find(".service-"+e+"  .service-variants :selected").data("price"))}else{d+=parseFloat($(this).data("price"))}});this.add2cart.find(".price").html(this.currencyFormat(d));this.form.find(".ajax_product_info").data("price",this.currencyFormat(d))};