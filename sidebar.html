{if !empty($filters)}
    <div id="layered_block_left" class="block">
        <p class="title_block">[`Filter`]</p>
        <div class="block_content">

            <div class="filters{if !empty($theme_settings.ajax_filters)} ajax{/if}">
                <form id="layered_form" method="get" action="{$wa->currentUrl(0,1)}">
                    {foreach $filters as $fid => $filter}
                        <div class="layered_filter">
                            {if $fid == 'price'}
                                {$c = $wa->shop->currency(true)}
                                <div class="layered_subtitle_heading">
                                    <span class="layered_subtitle">[`Price`]</span>
                                </div>
                                <ul class="col-lg-12 layered_filter_ul">
                                    <li class="nomargin hiddable col-lg-12">
                                        <label>
                                            [`from`]
                                        </label>
                                        <input class="form-control" type="text" name="price_min" {if $wa->get('price_min')}value="{(int)$wa->get('price_min')}"{/if} placeholder="{floor($filter.min)}"> {$c.sign}
                                    </li>
                                    <li class="nomargin hiddable col-lg-12">
                                        <label>
                                            [`to`]
                                        </label>
                                        <input class="form-control" type="text" name="price_max" {if $wa->get('price_max')}value="{(int)$wa->get('price_max')}"{/if} placeholder="{ceil($filter.max)}"> {$c.sign}
                                    </li>

                                    {if !empty($theme_settings.filter_slider)}
                                        <li>
                                            <div id="filter-slider"></div>
                                        </li>
                                    {/if}
                                </ul>
                                {if !empty($theme_settings.filter_slider)}
                                    <script type="text/javascript">
                                        var filter_slider_min_value = {floor($filter.min)};
                                        var filter_slider_max_value = {ceil($filter.max)};
                                        var filter_slider_min_price = {if $wa->get('price_min')}{(int)$wa->get('price_min')}{else}{floor($filter.min)}{/if};
                                        var filter_slider_max_price = {if $wa->get('price_max')}{(int)$wa->get('price_max')}{else}{ceil($filter.max)}{/if};
                                    </script>
                                {/if}




                            {else}
                                <div class="layered_subtitle_heading">
                                    <span class="layered_subtitle">{$filter.name|escape}</span>
                                </div>
                                {if $filter.type == 'boolean'}
                                    <ul class="col-lg-12 layered_filter_ul">

                                        <li class="nomargin hiddable col-lg-12">
                                            <input type="radio" name="{$filter.code}"{if $wa->get($filter.code)} checked{/if} value="1"> 
                                            <label>
                                                [`Yes`]
                                            </label>
                                        </li>
                                        <li class="nomargin hiddable col-lg-12">
                                            <input type="radio" name="{$filter.code}"{if $wa->get($filter.code) === '0'} checked{/if} value="0"> 
                                            <label>
                                                [`No`]
                                            </label>
                                        </li>
                                        <li class="nomargin hiddable col-lg-12">
                                            <input type="radio" name="{$filter.code}"{if $wa->get($filter.code, '') === ''} checked{/if} value=""> 
                                            <label>
                                                [`Any`]
                                            </label>
                                        </li>

                                    </ul>
                                {elseif isset($filter.min)}
                                    {$_v = $wa->get($filter.code)}
                                    [`from`] <input type="text" name="{$filter.code}[min]" placeholder="{$filter.min}" {if !empty($_v.min)}value="{$_v.min}"{/if}>
                                    [`to`] <input type="text" name="{$filter.code}[max]" placeholder="{$filter.max}" {if !empty($_v.max)}value="{$_v.max}"{/if}>
                                    {if !empty($filter.unit)}
                                        {$filter.unit.title}
                                        {if $filter.unit.value != $filter.base_unit.value}<input type="hidden" name="{$filter.code}[unit]" value="{$filter.unit.value}">{/if}
                                    {/if}
                                {else}
                                    <ul class="col-lg-12 layered_filter_ul">
                                        {foreach $filter.values as $v_id => $v}
                                            <li class="nomargin hiddable col-lg-12">
                                                <input type="checkbox" name="{$filter.code}[]" {if in_array($v_id, (array)$wa->get($filter.code, array()))}checked{/if} value="{$v_id}"> 
                                                <label>
                                                    {$v}
                                                </label>
                                            </li>
                                        {/foreach}
                                    </ul>
                                {/if}


                            {/if}
                        </div>

                    {/foreach}
                    {if $wa->get('sort')}<input type="hidden" name="sort" value="{$wa->get('sort')|escape}">{/if}
                    {if $wa->get('order')}<input type="hidden" name="order" value="{$wa->get('order')|escape}">{/if}
                    <p></p>
                    <input class="btn button" type="submit" value="[`Filter products`]">
                </form>
            </div>
        </div>
    </div>
{/if} 

{if $theme_settings.qutput_subcategories && !empty($category) && $wa->shop->categories($category.id, null, true)}
    <div id="categories_block_left" class="block">
        <h2 class="title_block">
            [`Subcategories`]
        </h2>
        <div class="block_content">
            {wa_print_tree tree=$wa->shop->categories($category.id, null, true) unfolded=true class="tree dhtml" elem ='<a href=":url" title=":name">:name</a>'}
        </div>
    </div>
{/if}

{if $theme_settings.category_popular_products && $wa->shop->productSet($theme_settings.category_popular_products_list)}
    <div id="best-sellers_block_right" class="block products_block">
        <h4 class="title_block">
            [`Popular products`]
        </h4>
        <div class="block_content">
            {include file="sidebar-products.html" products=$wa->shop->productSet($theme_settings.category_popular_products_list) inline class='block_content products-block'}
        </div>
    </div>
{/if}


{if $theme_settings.category_information_block && $wa->shop->pages()}
    <section id="informations_block_left_1" class="block informations_block_left">
        <h4 class="title_block">
            [`Information`]	
        </h4>
        <div class="block_content list-block">
            {wa_print_tree  unfolded=false tree=$wa->shop->pages() class="toggle-footer" elem ='<a href=":url" title=":title">:name</a>' selected=$wa->param('page_id')}
        </div>
    </section>
{/if}

{$viewed_products = waRequest::cookie('viewed_products')};
{if $theme_settings.category_viewed_products && !empty($viewed_products)}
    {$viewed_products = explode(',', $viewed_products)}
    <div id="viewed-products_block_left" class="block">
        <p class="title_block">
            <a href="{$wa->getUrl('/frontend/search')}?list=viewed_products">[`Viewed products`]</a>
        </p>
        <div class="block_content products-block">
            <ul>
                {foreach $viewed_products as $viewed_product_id}
                    {$product = $wa->shop->product($viewed_product_id)}

                    <li class="clearfix first_item">
                        <a class="products-block-image" href="{$wa->shop->productUrl($product)}" title="{$product.name}" >
                            {$wa->shop->productImgHtml($product, '98', [ 'itemprop' => 'image', 'alt' => $product.name|escape|cat:' ':strip_tags($product.summary)|escape ])}
                        </a>
                        <div class="product-content">
                            <h5>
                                <a class="product-name"	href="{$wa->shop->productUrl($product)}" title="{$product.name}">
                                    {$product.name}
                                </a>
                            </h5>
                            <p class="product-description">{$product.summary}</p>
                        </div>
                    </li>
                {if $viewed_product_id@iteration >= $theme_settings.category_viewed_products_count}{break}{/if}
            {/foreach}
        </ul>
    </div>
</div>

{/if}

{if $theme_settings.category_tags && $wa->shop->tags()}
    <div class="block tags_block">
        <p class="title_block">
            [`Tags`]
        </p>
        <div class="block_content blockstore">
            {if !empty($theme_settings.tagcanvas)}
                <div id="tag-cloud-canvas">
                    <canvas width="300" height="300" id="canvas"></canvas>
                </div>
            {/if}
            <div id="tag-cloud">
                <ul>
                    {foreach $wa->shop->tags() as $tag}
                        <li><a href="{$wa->getUrl('shop/frontend/tag',['tag' => $tag.uri_name])}" style="font-size: {$tag.size}%; opacity: {$tag.opacity}">{$tag.name|escape}</a></li>
                        {/foreach}
                </ul>
            </div>
        </div>
    </div>
{/if}




{if $theme_settings.category_blog && $wa->blog && $wa->blog->posts()}
    {$latest_posts = $wa->blog->posts()}
    <div class="block">
        <p class="title_block">
            <a href="{$wa->blog->url()}">[`News`]</a>
        </p>
        <div class="block_content">

            <ul class="list-cms-info">
                {foreach $latest_posts as $post}
                    <li class="post">
                        <h3>
                            <a href="{$post.link}">{$post.title}</a>
                            {* @event prepare_posts_frontend.%plugin_id%.post_title *}
                            {if !empty($post.plugins.post_title)}
                                {foreach $post.plugins.post_title as $plugin => $output}
                                    {$output}
                                {/foreach}
                            {/if}
                        </h3>
                        <div class="credentials">
                            {if $post.user.posts_link}
                                <a href="{$post.user.posts_link}" class="username">{$post.user.name}</a>
                            {else}
                                <span class="username">{$post.user.name}</span>
                            {/if}
                            {$post.datetime|wa_datetime:"humandate"}
                        </div>
                        <p>
                            {$post.text|strip_tags|truncate:100}
                        </p>
                    </li>
                {/foreach}
            </ul>

        </div>
    </div>
{/if}

<!-- tag cloud -->


<!-- plugin hook: 'frontend_nav' -->
{* @event frontend_nav.%plugin_id% *}
{if !empty($frontend_nav)}
    {foreach $frontend_nav as $_}
        {$_}
    {/foreach}
{/if}